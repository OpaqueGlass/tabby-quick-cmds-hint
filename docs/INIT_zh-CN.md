# åˆæ¬¡ä½¿ç”¨è¯´æ˜å’Œæ’ä»¶å®ç°æ–¹å¼çš„è§£é‡Š

> æœ€åæ›´æ–°äºï¼šv0.1.0 æ›´æ–°æ—¶ã€‚

## æ’ä»¶å®ç°æ–¹å¼è¯´æ˜

### 1. å‘½ä»¤å¼€å§‹è¾“å…¥åˆ¤æ–­

æ’ä»¶é€šè¿‡æ­£åˆ™åŒ¹é…åŸå§‹è¾“å‡ºä¸­çš„`CurrentDir.*\a`ç¡®è®¤å‘½ä»¤è¾“å…¥promptçš„ç»“æŸä½ç½®ï¼Œæ¸…ç†å…¶ä¸­çš„è½¬ä¹‰ç¬¦
ï¼Œå¹¶ç”±æ­¤åˆ¤æ–­promptçš„ç»“æŸå’Œå‘½ä»¤çš„å¼€å§‹ã€‚

å› æ­¤ï¼Œ`CurrentDir`ç›¸å…³çš„æç¤ºå¿…é¡»åœ¨å‘½ä»¤è¾“å…¥æç¤ºpromptçš„æœ«å°¾å‡ºç°ã€‚å¦åˆ™æ’ä»¶å°†ä¼šæŠŠprompté”™è¯¯
è¯†åˆ«ä¸ºå‘½ä»¤çš„ä¸€éƒ¨åˆ†ã€‚


### 2. å†å²å‘½ä»¤ï¼ˆå®é™…æ‰§è¡Œå‘½ä»¤ï¼‰è®°å½•

æ’ä»¶åŸºäºæ‰§è¡Œå‘½ä»¤åï¼Œshellé€šè¿‡`]2323;Command=$(cmd)\x07`è¿”å›æ‰§è¡Œçš„å‘½ä»¤è®°å½•ã€‚è¿™é‡Œæ˜¯è‡ªå®šä¹‰
çš„è½¬ä¹‰åºåˆ—ï¼Œæ²¡æœ‰å‚è€ƒæ¥æºã€‚å¦‚æœå’Œå…¶ä»–å·²æœ‰å®ç°å†²çªï¼Œè¯·åé¦ˆã€‚


## é’ˆå¯¹ä¸€äº›shellçš„é…ç½®å‚è€ƒ

> å¼€å‘è€…ä»…é’ˆå¯¹ Ubuntuä¸‹bash è¿›è¡Œå¼€å‘ä¸æµ‹è¯•ï¼Œä¸ä¿è¯åœ¨å…¶ä»–shellä¸­çš„å¯ç”¨æ€§ã€‚
>
> ç†è®ºä¸Šåªè¦shellæ»¡è¶³`å®ç°æ–¹å¼è¯´æ˜`ä¸­çš„è§„åˆ™ï¼Œå³å¯ä»¥è¢«è¯†åˆ«ï¼Œä½†ä¸åŒshellå¯èƒ½å­˜åœ¨å·®å¼‚ã€‚
> 
> å¦‚æœåœ¨bashä¸­å‡ºç°é—®é¢˜ï¼Œè¯·åé¦ˆbugã€‚å¦‚æœåœ¨å…¶ä»–shellä¸­å­˜åœ¨é—®é¢˜ï¼Œè¯·è€ƒè™‘æäº¤PRã€‚

#### bash

ç›´æ¥å‚è€ƒ[tabby/wiki/Shell-working-directory-reporting#bash](https://github.com/Eugeny/tabby/wiki/Shell-working-directory-reporting#bash)å³å¯ã€‚

åŸºæœ¬åŠŸèƒ½ï¼š

```bash
export PS1="$PS1\[\e]1337;CurrentDir="'$(pwd)\a\]'
```

å‘½ä»¤å†å²è®°å½•ï¼š

```bash
function preexec_invoke_exec() {
    printf "\033]2323;Command=%s\007" "$1"
}

trap 'preexec_invoke_exec "$BASH_COMMAND"' DEBUG
                                                      
```

#### fish

éœ€è¦ä¿®æ”¹é»˜è®¤çš„`fish_prompt`å‡½æ•°ã€‚

åŸå‡½æ•°ä»£ç å¯ä»¥å‚è€ƒ`/usr/share/fish/functions/fish_prompt.fish @ line 4`(æˆ–fishç»ˆç«¯è¾“å…¥`type fish_prompt`)

éœ€è¦åœ¨å‡½æ•°æœ€åè¡¥å……echo

```fish
echo -en "\e]1337;CurrentDir=$PWD\x7"
```